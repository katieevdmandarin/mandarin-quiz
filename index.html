<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡±è’‚ç”Ÿæ´»è¯èªï¼šDay 1-30 æŒ‘æˆ° Katie Everyday Mandarin: Day 1â€“30 Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.0/lucide-react.min.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- è«‹æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„ Firebase é…ç½® (å¯åœ¨ Firebase Console æ‰¾åˆ°) ---
        // æ³¨æ„ï¼šç‚ºäº†å®‰å…¨ï¼Œå»ºè­°åœ¨ Firebase Console è¨­å®šç¶²åŸŸç™½åå–® (GitHub ç¶²å€)
        const firebaseConfig = {
            apiKey: "", // é€™è£¡ç•™ç©ºï¼Œé‹è¡Œç’°å¢ƒæœƒè‡ªå‹•æ³¨å…¥æˆ–è«‹å¡«å…¥æ‚¨çš„ API Key
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        // å¦‚æœåœ¨æˆ‘å€‘çš„ç’°å¢ƒåŸ·è¡Œï¼Œæœƒè‡ªå‹•æŠ“å– __firebase_config
        const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'github-mandarin-quiz';

        // æ¸¬é©—è³‡æ–™
        const quizData = [
            {
                question: "æƒ…å¢ƒï¼šç•¶ä½ è½ä¸æ¸…æ¥šï¼Œæƒ³è«‹å°æ–¹ã€Œå†èªªä¸€æ¬¡ã€æ™‚ï¼Œå“ªå¥è¯èªæœ€åˆé©ï¼Ÿ",
                multi: "ID: Anda ingin meminta seseorang mengulangi...\nVI: Báº¡n muá»‘n yÃªu cáº§u ai Ä‘Ã³ nháº¯c láº¡i...\nPH: Gusto mong pakiusap na ulitin...",
                options: [
                    { text: "é€™å€‹å¯ä»¥å†èªªä¸€æ¬¡å—ï¼Ÿ", pinyin: "ZhÃ¨ ge kÄ› yÇ zÃ i shuÅ yÃ­ cÃ¬ ma?", en: "Can you say it again?", correct: true },
                    { text: "é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", pinyin: "ZhÃ¨ ge duÅ shÇo qiÃ¡n?", en: "How much is it?", correct: false },
                    { text: "ä½ è¦å»å“ªè£¡ï¼Ÿ", pinyin: "NÇ yÃ o qÃ¹ nÇ lÇ?", en: "Where are you going?", correct: false }
                ]
            },
            {
                question: "æƒ…å¢ƒï¼šå°æ–¹èªªè©±å¤ªå¿«äº†ï¼Œè«‹ä»–ã€Œèªªæ…¢ä¸€é»ã€çš„æ­£ç¢ºèªªæ³•æ˜¯ï¼Ÿ",
                multi: "ID: Minta mereka bicara pelan...\nVI: YÃªu cáº§u há» nÃ³i cháº­m láº¡i...\nPH: Pakiusap na bagalan...",
                options: [
                    { text: "å¯ä»¥èªªå¿«ä¸€é»å—ï¼Ÿ", pinyin: "KÄ› yÇ shuÅ kuÃ i yÃ¬ diÇn ma?", en: "Can you speak faster?", correct: false },
                    { text: "å¯ä»¥èªªæ…¢ä¸€é»å—ï¼Ÿ", pinyin: "KÄ› yÇ shuÅ mÃ n yÃ¬ diÇn ma?", en: "Can you speak more slowly?", correct: true },
                    { text: "æˆ‘è½åˆ°äº†ã€‚", pinyin: "WÇ’ tÄ«ng dÃ o le.", en: "I heard it.", correct: false }
                ]
            },
            {
                question: "æƒ…å¢ƒï¼šåœ¨å·¥å» çœ‹åˆ°å±éšªï¼Œè¦æé†’åŒäº‹ã€Œå°å¿ƒï¼Œå±éšªï¼ã€æ™‚èªªï¼Ÿ",
                multi: "ID: Memperingatkan bahaya...\nVI: Cáº£nh bÃ¡o nguy hiá»ƒm...\nPH: Babala sa panganib...",
                options: [
                    { text: "å°å¿ƒï¼Œå±éšªï¼", pinyin: "XiÇo xÄ«n, wÃ©i xiÇn!", en: "Watch out, danger!", correct: true },
                    { text: "è¾›è‹¦äº†ã€‚", pinyin: "XÄ«n kÇ” le.", en: "Good work.", correct: false },
                    { text: "æ—©å®‰ã€‚", pinyin: "ZÇo Än.", en: "Good morning.", correct: false }
                ]
            }
        ];

        let currentStep = 0;
        let score = 0;
        let userData = { name: '', email: '' };

        window.startQuiz = async () => {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            if(!name || !email) return alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š Please fill in all required information');
            
            userData = { name, email };
            await signInAnonymously(auth);
            
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            renderQuestion();
        };

        function renderQuestion() {
            const q = quizData[currentStep];
            document.getElementById('progress').style.width = `${((currentStep+1)/quizData.length)*100}%`;
            document.getElementById('q-title').innerText = q.question;
            document.getElementById('q-multi').innerText = q.multi;
            
            const optionsHtml = q.options.map((opt, idx) => `
                <button onclick="handleAnswer(${opt.correct}, ${idx})" id="opt-${idx}" class="w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-200 transition-all">
                    <div class="font-bold text-slate-800">${opt.text}</div>
                    <div class="text-xs text-indigo-500 italic">${opt.pinyin}</div>
                    <div class="text-[10px] text-slate-400 uppercase">${opt.en}</div>
                </button>
            `).join('');
            document.getElementById('options-container').innerHTML = optionsHtml;
        }

        window.handleAnswer = async (isCorrect, idx) => {
            const btns = document.querySelectorAll('#options-container button');
            btns.forEach(b => b.disabled = true);
            
            const selected = document.getElementById(`opt-${idx}`);
            if(isCorrect) {
                selected.classList.add('border-emerald-500', 'bg-emerald-50');
                score++;
            } else {
                selected.classList.add('border-rose-500', 'bg-rose-50');
            }

            setTimeout(async () => {
                if(currentStep + 1 < quizData.length) {
                    currentStep++;
                    renderQuestion();
                } else {
                    await finishQuiz();
                }
            }, 1000);
        };

        async function finishQuiz() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('loading-screen').classList.remove('hidden');
            
            try {
                // å„²å­˜åˆ° Firestore
                const resultsRef = collection(db, 'artifacts', appId, 'public', 'data', 'quiz_results');
                await addDoc(resultsRef, {
                    name: userData.name,
                    email: userData.email,
                    score: score,
                    total: quizData.length,
                    date: new Date().toISOString()
                });
            } catch(e) {
                console.error(e);
            }

            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;
            document.getElementById('user-msg').innerText = `æ­å–œ ${userData.name}ï¼Congratulations!æ‰‹å†Šå·²æº–å‚™å¥½ç™¼é€è‡³ The handbook is ready to be sent to ${userData.email}`;
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold italic">å‡±è’‚ç”Ÿæ´»è¯èª</h1>
            <p class="text-indigo-100 text-xs tracking-widest uppercase mt-1">Day 1-30 Review Challenge</p>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" class="p-8">
            <h2 class="text-xl font-bold text-slate-800 mb-6">é–‹å§‹è¤‡ç¿’æ¸¬é©—</h2>
            <div class="space-y-4">
                <input id="name" type="text" placeholder="æ‚¨çš„å§“å / Name" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                <input id="email" type="email" placeholder="æ‚¨çš„ Email" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                <button onclick="startQuiz()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-indigo-700 transition-all">
                    é€²å…¥æ¸¬é©— (Start)
                </button>
            </div>
            <p class="mt-4 text-[10px] text-slate-400 text-center">Leave your information to receive the complete Day 1â€“30 vocabulary handbook</p>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="p-8 hidden">
            <div class="w-full bg-slate-100 h-2 rounded-full mb-6 overflow-hidden">
                <div id="progress" class="bg-indigo-500 h-full transition-all w-0"></div>
            </div>
            <h3 id="q-title" class="text-lg font-bold text-slate-800 mb-2"></h3>
            <div id="q-multi" class="text-xs text-slate-500 bg-slate-50 p-3 rounded-lg mb-6 whitespace-pre-wrap border border-slate-100 italic"></div>
            <div id="options-container" class="space-y-3"></div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="p-12 text-center hidden">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-slate-500">æ­£åœ¨å„²å­˜çµæœ...</p>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="p-8 text-center hidden">
            <div class="text-5xl mb-4">ğŸ†</div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2">æ¸¬é©—å®Œæˆï¼</h2>
            <p id="user-msg" class="text-sm text-slate-500 mb-6"></p>
            <div class="bg-indigo-50 rounded-2xl p-6 mb-6">
                <div class="text-xs text-indigo-400 font-bold uppercase">Your Score</div>
                <div id="final-score" class="text-4xl font-black text-indigo-600"></div>
            </div>
            <button onclick="window.location.reload()" class="text-indigo-600 font-bold text-sm underline">å†æ¸¬ä¸€æ¬¡ (Try Again)</button>
        </div>

        <div class="bg-slate-50 p-4 text-[10px] text-slate-400 text-center">
            Katie Everyday Mandarin Â© 2025 â€¢ Designed for Your Taiwan Survival Mandarin Projet
        </div>
    </div>

</body>
</html>

