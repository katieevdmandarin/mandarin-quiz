<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katie Everyday Mandarin - Day 1-30 Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- 1. Firebase é…ç½® (è«‹åœ¨æ­¤å¡«å…¥æ‚¨çš„å¯¦ä½œé…ç½®) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDVDEEvvYjDJDUVkwG6tdDwRETXMiXmzsA",
  authDomain: "katie-mandarin.firebaseapp.com",
  projectId: "katie-mandarin",
  storageBucket: "katie-mandarin.firebasestorage.app",
  messagingSenderId: "565962775476",
  appId: "1:565962775476:web:0c36c51164de3be82c30e1",
  measurementId: "G-TY4DQT7VWZ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'katie-everyday-mandarin-v1';

        // ç‹€æ…‹ç®¡ç†
        let currentStep = 0;
        let score = 0;
        let userData = { name: '', email: '' };
        let adminClickCount = 0;

        // --- 2. ç®¡ç†å“¡å¯†ç¢¼è¨­å®š ---
        const ADMIN_PASSWORD = "@Katie20251231"; 

        // é¡Œåº«è³‡æ–™
        const quizData = [
            {
                question: "æƒ…å¢ƒï¼šç•¶ä½ è½ä¸æ¸…æ¥šï¼Œæƒ³è«‹å°æ–¹ã€Œå†èªªä¸€æ¬¡ã€æ™‚...\nScenario: You want to ask someone to say it again...",
                multi: "ğŸ‡®ğŸ‡© Bisa diulang sekali lagi?\nğŸ‡»ğŸ‡³ CÃ³ thá»ƒ nÃ³i láº¡i má»™t láº§n ná»¯a khÃ´ng?\nğŸ‡µğŸ‡­ Maaari mo bang ulitin?",
                options: [
                    { text: "é€™å€‹å¯ä»¥å†èªªä¸€æ¬¡å—ï¼Ÿ", pinyin: "ZhÃ¨ ge kÄ› yÇ zÃ i shuÅ yÃ­ cÃ¬ ma?", correct: true },
                    { text: "é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", pinyin: "ZhÃ¨ ge duÅ shÇo qiÃ¡n?", correct: false },
                    { text: "ä½ è¦å»å“ªè£¡ï¼Ÿ", pinyin: "NÇ yÃ o qÃ¹ nÇ lÇ?", correct: false }
                ],
                hint: "Day 3"
            },
            {
                question: "æƒ…å¢ƒï¼šå°æ–¹èªªè©±å¤ªå¿«äº†ï¼Œè«‹ä»–ã€Œèªªæ…¢ä¸€é»ã€...\nScenario: Someone is speaking too fast, ask them to slow down...",
                multi: "ğŸ‡®ğŸ‡© Bisa bicara lebih pelan?\nğŸ‡»ğŸ‡³ CÃ³ thá»ƒ nÃ³i cháº­m hÆ¡n khÃ´ng?\nğŸ‡µğŸ‡­ Maaari ka bang magsalita ng mas mabagal?",
                options: [
                    { text: "å¯ä»¥èªªå¿«ä¸€é»å—ï¼Ÿ", pinyin: "KÄ› yÇ shuÅ kuÃ i yÃ¬ diÇn ma?", correct: false },
                    { text: "å¯ä»¥èªªæ…¢ä¸€é»å—ï¼Ÿ", pinyin: "KÄ› yÇ shuÅ mÃ n yÃ¬ diÇn ma?", correct: true },
                    { text: "æˆ‘è½åˆ°äº†ã€‚", pinyin: "WÇ’ tÄ«ng dÃ o le.", correct: false }
                ],
                hint: "Day 4"
            },
            {
                question: "æƒ…å¢ƒï¼šæƒ³è«‹æ•™å•é¡Œå‰ï¼Œæœ€æœ‰ç¦®è²Œçš„é–‹é ­æ˜¯ï¼Ÿ\nScenario: The most polite way to start a question...",
                multi: "ğŸ‡®ğŸ‡© Permisi... ğŸ‡»ğŸ‡³ Xin há»i... ğŸ‡µğŸ‡­ Maaari...",
                options: [
                    { text: "è«‹å•...", pinyin: "QÇng wÃ¨n...", correct: true },
                    { text: "å°ä¸èµ·ã€‚", pinyin: "DuÃ¬ bÃ¹ qÇ.", correct: false },
                    { text: "é¤µï¼", pinyin: "WÃ¨i!", correct: false }
                ],
                hint: "Day 1"
            }
        ];

        // éš±è—ç®¡ç†å“¡å…¥å£
        window.triggerAdmin = () => {
            adminClickCount++;
            if (adminClickCount === 5) {
                const pass = prompt("ç®¡ç†å“¡ç™»å…¥ / Admin Loginï¼š");
                if (pass === ADMIN_PASSWORD) {
                    showAdminPanel();
                } else if (pass !== null) {
                    alert("å¯†ç¢¼éŒ¯èª¤ / Incorrect Password");
                    adminClickCount = 0;
                }
            }
        };

        async function showAdminPanel() {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('admin-panel').classList.remove('hidden');
            await loadRecords();
        }

        async function loadRecords() {
            const listEl = document.getElementById('record-list');
            listEl.innerHTML = '<div class="p-8 text-center text-slate-400">Loading...</div>';
            try {
                await signInAnonymously(auth);
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'quiz_results');
                const snap = await getDocs(colRef);
                const data = [];
                snap.forEach(doc => data.push(doc.data()));
                window.cachedData = data;

                listEl.innerHTML = data.map(r => `
                    <div class="p-4 border-b flex justify-between items-center text-sm">
                        <div>
                            <div class="font-bold text-slate-800">${r.name}</div>
                            <div class="text-[10px] text-slate-400 font-mono">${r.email}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-indigo-600 font-black">${r.score}/${r.total}</div>
                            <div class="text-[9px] text-slate-300 font-bold">${r.createdAt?.toDate ? r.createdAt.toDate().toLocaleDateString() : ''}</div>
                        </div>
                    </div>
                `).join('') || '<p class="p-8 text-center text-slate-400 uppercase text-[10px] font-bold">No records found</p>';
            } catch (e) {
                listEl.innerHTML = `<p class="p-4 text-rose-500 text-xs">Error: ${e.message}</p>`;
            }
        }

        window.downloadCSV = () => {
            if(!window.cachedData) return;
            let csv = "\ufeffName,Email,Score,Total,Date\n";
            window.cachedData.forEach(r => {
                const date = r.createdAt?.toDate ? r.createdAt.toDate().toLocaleString() : '';
                csv += `"${r.name}","${r.email}",${r.score},${r.total},"${date}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Katie_Student_List_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        };

        // æ¸¬é©—æ§åˆ¶
        window.startQuiz = () => {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            if(!name || !email) return alert("è«‹å¡«å¯«å§“åèˆ‡é›»å­éƒµä»¶ / Please fill in name and email");
            userData = { name, email };
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            renderQuestion();
        };

        function renderQuestion() {
            const q = quizData[currentStep];
            document.getElementById('progress-bar').style.width = `${((currentStep+1)/quizData.length)*100}%`;
            document.getElementById('q-title').innerText = q.question;
            document.getElementById('q-multi').innerText = q.multi;
            document.getElementById('q-hint').innerText = "ğŸ’¡ Hint: " + q.hint;
            document.getElementById('options-container').innerHTML = q.options.map((opt, idx) => `
                <button onclick="handleAnswer(${opt.correct}, ${idx})" id="opt-${idx}" class="w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-200 transition-all shadow-sm">
                    <div class="font-bold text-slate-800 text-lg">${opt.text}</div>
                    <div class="text-sm text-indigo-600 italic font-medium">${opt.pinyin}</div>
                </button>
            `).join('');
        }

        window.handleAnswer = (isCorrect, idx) => {
            const btns = document.querySelectorAll('#options-container button');
            btns.forEach(b => b.disabled = true);
            const el = document.getElementById(`opt-${idx}`);
            if(isCorrect) {
                score++;
                el.classList.add('bg-emerald-50', 'border-emerald-500');
            } else {
                el.classList.add('bg-rose-50', 'border-rose-500');
            }
            setTimeout(async () => {
                if(currentStep + 1 < quizData.length) {
                    currentStep++;
                    renderQuestion();
                } else {
                    await finish();
                }
            }, 800);
        };

        async function finish() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('loading-screen').classList.remove('hidden');
            try {
                await signInAnonymously(auth);
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'quiz_results');
                await addDoc(colRef, { ...userData, score, total: quizData.length, createdAt: serverTimestamp() });
            } catch (e) { console.error(e); }
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / ${quizData.length}`;
            document.getElementById('final-msg').innerText = `è¬›ç¾©å°‡ç™¼é€è‡³ / Vocab list will be sent to:\n${userData.email}`;
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100">
        
        <!-- Header (é»æ“Šæ­¤è™• 5 æ¬¡é€²å…¥å¾Œå°) -->
        <header onclick="triggerAdmin()" class="bg-indigo-600 p-8 text-white text-center cursor-default select-none">
            <h1 class="text-2xl font-extrabold tracking-tight italic">Katie Everyday Mandarin</h1>
            <p class="text-indigo-100 text-[10px] tracking-[0.2em] uppercase mt-2 font-bold italic">Review Quiz & Student List</p>
        </header>

        <!-- é¦–é  (ä¸­è‹±å°ç…§ç‰ˆ) -->
        <section id="login-screen" class="p-8">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-slate-800 italic">æº–å‚™å¥½é ˜å–è¬›ç¾©äº†å—ï¼Ÿ</h2>
                <p class="text-slate-400 text-xs font-medium">Ready to get your vocabulary list?</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1 text-left">å§“å / Name</label>
                    <input id="name" type="text" placeholder="e.g. Katie Chen" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1 text-left">é›»å­éƒµä»¶ / Email</label>
                    <input id="email" type="email" placeholder="name@example.com" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                </div>
                <button onclick="startQuiz()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-[0.98] mt-2">
                    é–‹å§‹æ¸¬é©— / Start Quiz
                </button>
            </div>

            <div class="mt-8 p-4 bg-amber-50 rounded-2xl border border-amber-100">
                <p class="text-[10px] text-amber-700 leading-relaxed font-medium text-center italic">
                    å®Œæˆæ¸¬é©—å³å¯ç²å¾— Day 1-30 å®Œæ•´å°ç…§å–®å­—è¡¨ã€‚<br>
                    Receive the full vocabulary list after completing the quiz.
                </p>
            </div>
        </section>

        <!-- æ¸¬é©—ä»‹é¢ -->
        <section id="quiz-screen" class="p-8 hidden text-left">
            <div class="w-full bg-slate-100 h-1.5 rounded-full mb-6 overflow-hidden">
                <div id="progress-bar" class="bg-indigo-500 h-full transition-all w-0"></div>
            </div>
            <h3 id="q-title" class="text-lg font-bold text-slate-800 mb-2 min-h-[3rem] whitespace-pre-line leading-snug"></h3>
            <div id="q-multi" class="text-xs text-slate-500 bg-slate-50 p-4 rounded-xl mb-4 italic leading-relaxed whitespace-pre-line border border-slate-100"></div>
            <div id="options-container" class="space-y-3"></div>
            <div id="q-hint" class="mt-6 text-[10px] text-amber-600 font-bold bg-amber-50 p-2 rounded-lg text-center tracking-widest uppercase"></div>
        </section>

        <!-- è¼‰å…¥ä¸­ -->
        <section id="loading-screen" class="p-12 text-center hidden">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-slate-400 text-[10px] font-bold uppercase tracking-widest">Saving Results...</p>
        </section>

        <!-- çµæœä»‹é¢ -->
        <section id="result-screen" class="p-8 text-center hidden">
            <div class="text-5xl mb-4">ğŸ‰</div>
            <h2 class="text-2xl font-bold text-slate-800 italic">æ¸¬é©—å®Œæˆï¼ / Quiz Done!</h2>
            <div class="bg-indigo-50 rounded-2xl p-6 my-6 border border-indigo-100">
                <div class="text-[10px] text-indigo-400 font-bold uppercase mb-1">Total Score</div>
                <div id="final-score" class="text-5xl font-black text-indigo-600 tracking-tighter"></div>
            </div>
            <p id="final-msg" class="text-sm text-slate-500 mb-6 whitespace-pre-line"></p>
            <button onclick="window.location.reload()" class="text-indigo-600 font-bold text-sm hover:underline italic">å†æ¸¬ä¸€æ¬¡ / Try Again</button>
        </section>

        <!-- ç®¡ç†é¢æ¿ (å¾Œå°) -->
        <section id="admin-panel" class="p-6 hidden bg-slate-50 text-left">
            <div class="flex justify-between items-end mb-4 px-1">
                <div>
                    <h2 class="font-black text-indigo-600 text-lg uppercase">Students</h2>
                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Admin Console</p>
                </div>
                <button onclick="window.location.reload()" class="text-[9px] text-slate-300 font-bold uppercase hover:text-slate-600">Logout</button>
            </div>
            <button onclick="downloadCSV()" class="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl shadow-md mb-4 text-sm flex items-center justify-center gap-2 hover:bg-emerald-700 transition-colors">
                ä¸‹è¼‰ CSV åå–® / Export CSV
            </button>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-100 p-2 text-[9px] font-bold text-slate-400 text-center uppercase tracking-widest">Latest Records</div>
                <div id="record-list" class="max-h-[350px] overflow-y-auto">
                    <!-- åå–® -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-slate-50 p-6 text-[10px] text-slate-400 text-center border-t border-slate-100">
            <strong>KATIE EVERYDAY MANDARIN</strong> Â© 2025<br>
            <span class="opacity-70 italic">Empowering your life in Taiwan.</span>
        </footer>
    </div>

</body>
</html>

